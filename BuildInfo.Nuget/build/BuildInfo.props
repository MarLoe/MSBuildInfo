<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="GenerateBuildInfo" />

  <UsingTask
    TaskName="BuildInfoTask"
    AssemblyFile="$(MSBuildThisFileDirectory)..\tools\BuildInfo.Tasks.dll" />

  <Target Name="BuildInfo_PostBuild" AfterTargets="Build" DependsOnTargets="GenerateBuildInfo">
    <PropertyGroup>
      <BuildTargetFramework Condition="'$(BuildTargetFramework)' == ''">$(TargetFramework)</BuildTargetFramework>

      <BuildInfoId Condition="'$(BuildInfoId)' == ''">$(_AndroidPackage)</BuildInfoId>
      <BuildInfoId Condition="'$(BuildInfoId)' == ''">$(_BundleIdentifier)</BuildInfoId>
      <BuildInfoId Condition="'$(BuildInfoId)' == ''">$(ApplicationId)</BuildInfoId>
      <BuildInfoVersion Condition="'$(BuildInfoVersion)' == ''">$(ApplicationVersion)</BuildInfoVersion>
      <BuildInfoDisplayVersion Condition="'$(BuildInfoDisplayVersion)' == ''">$(ApplicationDisplayVersion)</BuildInfoDisplayVersion>
      <BuildInfoTitle Condition="'$(BuildInfoTitle)' == ''">$(ApplicationTitle)</BuildInfoTitle>

      <BuildInfoVariant Condition="'$(BuildInfoDisplayVersion)' == ''">$(BuildVariant)</BuildInfoVariant>
      <BuildInfoVariant Condition="'$(BuildInfoVariant)' == ''">$(ApplicationVariant)</BuildInfoVariant>
    </PropertyGroup>

    <PropertyGroup>
      <BuildInfoPath Condition="'$(BuildInfoPath)' == ''">$(PublishDir)</BuildInfoPath>
      <BuildInfoPath Condition="'$(BuildInfoPath)' == ''">$(OutputPath)</BuildInfoPath>
      <BuildInfoName Condition="'$(BuildInfoName)' == ''">BuildInfo.json</BuildInfoName>
    </PropertyGroup>

    <ItemGroup>
      <BuildInfo Include="BuildTargetFramework" Value="$(BuildTargetFramework)" />
      <BuildInfo Include="BuildInfoId" Value="$(BuildInfoId)" />
      <BuildInfo Include="BuildInfoVersion" Value="$(BuildInfoVersion)" />
      <BuildInfo Include="BuildInfoDisplayVersion" Value="$(BuildInfoDisplayVersion)" />
      <BuildInfo Include="BuildInfoTitle" Value="$(BuildInfoTitle)" />
      <BuildInfo Include="BuildInfoVariant" Value="$(BuildInfoVariant)" />
      <BuildInfo Include="BuildInfoName" Value="$(BuildInfoName)" />
    </ItemGroup>

    <BuildInfoTask Path="$(BuildInfoPath)" Name="$(BuildInfoName)" BuildInfo="@(BuildInfo)" />
  </Target>

</Project>